\doxysubsection{controllers/uav\+\_\+controller/src/main.c File Reference}
\hypertarget{main_8c}{}\label{main_8c}\index{controllers/uav\_controller/src/main.c@{controllers/uav\_controller/src/main.c}}


Main file of the controller.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \"{}includes/uav.\+h\"{}}\newline
{\ttfamily \#include \"{}modules/includes/fds.\+h\"{}}\newline
{\ttfamily \#include \"{}util/includes/map.\+h\"{}}\newline
{\ttfamily \#include \"{}util/includes/util.\+h\"{}}\newline
{\ttfamily \#include \"{}util/includes/vec.\+h\"{}}\newline
\doxysubsubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_a0a19204b959fe20f3fc034a2590309e3}\label{main_8c_a0a19204b959fe20f3fc034a2590309e3} 
\#define {\bfseries GOAL\+\_\+X}~20.\+0f
\item 
\Hypertarget{main_8c_a343b67e7c8e5d34396bacc80133c0cf0}\label{main_8c_a343b67e7c8e5d34396bacc80133c0cf0} 
\#define {\bfseries GOAL\+\_\+Y}~0.\+0f
\item 
\Hypertarget{main_8c_a67847dbbccd5a6eede5eb814d8cc4e48}\label{main_8c_a67847dbbccd5a6eede5eb814d8cc4e48} 
\#define {\bfseries TARGT\+\_\+\+ALT}~2.\+0f
\end{DoxyCompactItemize}
\doxysubsubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_aea5b81dcbca6a72061713814e14ed59c}{set\+\_\+id}} (\mbox{\hyperlink{uav_8h_ad5913810cc5e4e9a6de5a7e53b7df545}{Uav}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structuav}{uav}}, \mbox{\hyperlink{unionVec3d}{Vec3d}} start)
\item 
void \mbox{\hyperlink{main_8c_a9f928aba570fe88f04eba2db59b62459}{set\+\_\+start\+\_\+and\+\_\+goal}} (\mbox{\hyperlink{uav_8h_ad5913810cc5e4e9a6de5a7e53b7df545}{Uav}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structuav}{uav}})
\item 
int \mbox{\hyperlink{main_8c_a05848de25ac2dbec233935058a1d24b4}{init}} ()
\item 
void \mbox{\hyperlink{main_8c_a13a43e6d814de94978c515cb084873b1}{run}} ()
\item 
void \mbox{\hyperlink{main_8c_a6ab0e9e9dca182b4c36bbc0d0718ecb8}{follower\+\_\+wait}} ()
\item 
void \mbox{\hyperlink{main_8c_a79d916211b3eca38a97c2ed92986a944}{follower\+\_\+run}} ()
\item 
void \mbox{\hyperlink{main_8c_a92a88abf0da2b17a5321e42b74bdb2bd}{main\+\_\+loop}} (int timestep)
\item 
void \mbox{\hyperlink{main_8c_ada7f892aa09adca3647631590ca1beb0}{clean\+\_\+up}} ()
\item 
int \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char \texorpdfstring{$\ast$}{*}argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\doxysubsubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_a3220f4b82d7be7ab65f9bb05bc0ebd1a}\label{main_8c_a3220f4b82d7be7ab65f9bb05bc0ebd1a} 
\mbox{\hyperlink{uav_8h_ad5913810cc5e4e9a6de5a7e53b7df545}{Uav}} {\bfseries uav}
\end{DoxyCompactItemize}


\doxysubsubsection{Detailed Description}
Main file of the controller. 

This file contains the initialization, main loop and clean up functions. 

\doxysubsubsection{Function Documentation}
\Hypertarget{main_8c_ada7f892aa09adca3647631590ca1beb0}\label{main_8c_ada7f892aa09adca3647631590ca1beb0} 
\index{main.c@{main.c}!clean\_up@{clean\_up}}
\index{clean\_up@{clean\_up}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{clean\_up()}{clean\_up()}}
{\footnotesize\ttfamily void clean\+\_\+up (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

The clean up function \Hypertarget{main_8c_a79d916211b3eca38a97c2ed92986a944}\label{main_8c_a79d916211b3eca38a97c2ed92986a944} 
\index{main.c@{main.c}!follower\_run@{follower\_run}}
\index{follower\_run@{follower\_run}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{follower\_run()}{follower\_run()}}
{\footnotesize\ttfamily void follower\+\_\+run (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

The main function of the followers. It handles the received waypoints and coordinates the movements. \Hypertarget{main_8c_a6ab0e9e9dca182b4c36bbc0d0718ecb8}\label{main_8c_a6ab0e9e9dca182b4c36bbc0d0718ecb8} 
\index{main.c@{main.c}!follower\_wait@{follower\_wait}}
\index{follower\_wait@{follower\_wait}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{follower\_wait()}{follower\_wait()}}
{\footnotesize\ttfamily void follower\+\_\+wait (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This functions makes the followers wait until a message is received \Hypertarget{main_8c_a05848de25ac2dbec233935058a1d24b4}\label{main_8c_a05848de25ac2dbec233935058a1d24b4} 
\index{main.c@{main.c}!init@{init}}
\index{init@{init}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily int init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function initializes the program. First it initializes the webots controller, then it initializes debug logging, and the UAV itself. It also call a function to set the start goal. \Hypertarget{main_8c_a0ddf1224851353fc92bfbff6f499fa97}\label{main_8c_a0ddf1224851353fc92bfbff6f499fa97} 
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char \texorpdfstring{$\ast$}{*}}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}

The main function \Hypertarget{main_8c_a92a88abf0da2b17a5321e42b74bdb2bd}\label{main_8c_a92a88abf0da2b17a5321e42b74bdb2bd} 
\index{main.c@{main.c}!main\_loop@{main\_loop}}
\index{main\_loop@{main\_loop}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{main\_loop()}{main\_loop()}}
{\footnotesize\ttfamily void main\+\_\+loop (\begin{DoxyParamCaption}\item[{int}]{timestep }\end{DoxyParamCaption})}

The main loop function proper. Depending on the values of the state of the UAV different functions are called. \Hypertarget{main_8c_a13a43e6d814de94978c515cb084873b1}\label{main_8c_a13a43e6d814de94978c515cb084873b1} 
\index{main.c@{main.c}!run@{run}}
\index{run@{run}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily void run (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is the backbone of the program. It is the main function of the leader UAV and it is responisble for planning the path of the leader and followers, and coordinate the movements. \Hypertarget{main_8c_aea5b81dcbca6a72061713814e14ed59c}\label{main_8c_aea5b81dcbca6a72061713814e14ed59c} 
\index{main.c@{main.c}!set\_id@{set\_id}}
\index{set\_id@{set\_id}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{set\_id()}{set\_id()}}
{\footnotesize\ttfamily void set\+\_\+id (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{uav_8h_ad5913810cc5e4e9a6de5a7e53b7df545}{Uav}} \texorpdfstring{$\ast$}{*}}]{uav,  }\item[{\mbox{\hyperlink{unionVec3d}{Vec3d}}}]{start }\end{DoxyParamCaption})}

This function randomly generates an id give the initial staring position of the UAV. It uses the position as seeds. \Hypertarget{main_8c_a9f928aba570fe88f04eba2db59b62459}\label{main_8c_a9f928aba570fe88f04eba2db59b62459} 
\index{main.c@{main.c}!set\_start\_and\_goal@{set\_start\_and\_goal}}
\index{set\_start\_and\_goal@{set\_start\_and\_goal}!main.c@{main.c}}
\doxyparagraph{\texorpdfstring{set\_start\_and\_goal()}{set\_start\_and\_goal()}}
{\footnotesize\ttfamily void set\+\_\+start\+\_\+and\+\_\+goal (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{uav_8h_ad5913810cc5e4e9a6de5a7e53b7df545}{Uav}} \texorpdfstring{$\ast$}{*}}]{uav }\end{DoxyParamCaption})}

This funtion gets the GPS position of the UAV and creates two vector, goal and start, based on predefined value and the GPS position. The initial position is rounded to the nearest integer. 